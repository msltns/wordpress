(function(a){a.fn.columnize=function(b){var b=a.extend({width:400,columns:!1,buildOnce:!1,overflow:!1,doneFunc:function(){},target:!1,ignoreImageLoading:!0,float:"left",lastNeverTallest:!1},b);return this.each(function(){function c(c,d,e,f){for(;e.height()<f&&d[0].childNodes.length;)c.append(d[0].childNodes[0]);if(0!=c[0].childNodes.length){var g=c[0].childNodes,h=g[g.length-1];c[0].removeChild(h);var i=a(h);if(3==i[0].nodeType){var j=i[0].nodeValue,k=b.width/18;b.accuracy&&(k=b.accuracy);for(var l,m=null;e.height()<f&&j.length;)l="-1"==j.indexOf(" ",k)?j:j.substring(0,j.indexOf(" ",k)),m=document.createTextNode(l),c.append(m),j=j.length>k?j.substring(j.indexOf(" ",k)):"";if(e.height()>=f&&null!=m&&(c[0].removeChild(m),j=m.nodeValue+j),j.length)i[0].nodeValue=j;else return!1}return d.children().length?d.prepend(i):d.append(i),3==i[0].nodeType}}function d(a,b,e,f){b.children().length&&($cloneMe=b.children(":first"),$clone=$cloneMe.clone(!0),1==$clone.attr("nodeType")&&!$clone.hasClass("dontend")&&(a.append($clone),$clone.is("img")&&e.height()<f+20?$cloneMe.remove():!$cloneMe.hasClass("dontsplit")&&e.height()<f+20?$cloneMe.remove():$clone.is("img")||$cloneMe.hasClass("dontsplit")?$clone.remove():($clone.empty(),!c($clone,$cloneMe,e,f)&&$cloneMe.children().length&&d($clone,$cloneMe,e,f),0==$clone.get(0).childNodes.length&&$clone.remove())))}function e(){if(!(h.data("columnized")&&1==h.children().length)){if(h.data("columnized",!0),h.data("columnizing",!0),h.empty(),h.append(a("<div class='first last column' style='width:98%; padding: 3px; float: "+b.float+";'></div>")),$col=h.children().eq(h.children().length-1),$destroyable=k.clone(!0),b.overflow){for(targetHeight=b.overflow.height,c($col,$destroyable,$col,targetHeight),$destroyable.children().find(":first-child").hasClass("dontend")||d($col,$destroyable,$col,targetHeight);f($col.children(":last").length&&$col.children(":last").get(0));){var e=$col.children(":last");e.remove(),$destroyable.prepend(e)}for(var g="",j=document.createElement("DIV");0<$destroyable[0].childNodes.length;){for(var l=$destroyable[0].childNodes[0],m=0;m<l.attributes.length;m++)0==l.attributes[m].nodeName.indexOf("jQuery")&&l.removeAttribute(l.attributes[m].nodeName);j.innerHTML="",j.appendChild($destroyable[0].childNodes[0]),g+=j.innerHTML}var n=a(b.overflow.id)[0];n.innerHTML=g}else $col.append($destroyable);h.data("columnizing",!1),b.overflow&&b.overflow.doneFunc()}}function f(b){return 1==b.nodeType&&(!!a(b).hasClass("dontend")||0!=b.childNodes.length&&f(b.childNodes[b.childNodes.length-1]))}function g(){if(l!=h.width()){l=h.width();var g=Math.round(h.width()/b.width);if(b.columns&&(g=b.columns),1>=g)return e();if(!h.data("columnizing")){h.data("columnized",!0),h.data("columnizing",!0),h.empty(),h.append(a("<div style='width:"+(Math.round(100/g)-2)+"%; padding: 3px; float: "+b.float+";'></div>")),t=h.children(":last"),t.append(k.clone()),j=t.height(),h.empty();var m=j/g,n=3,o=!1;b.overflow?(n=1,m=b.overflow.height):b.height&&b.width&&(n=1,m=b.height,o=!0);for(var p=0;p<n;p++){h.empty();var q;try{q=k.clone(!0)}catch(a){q=k.clone()}q.css("visibility","hidden");for(var r=0;r<g;r++){var s=0==r?"first column":"column",s=r==g-1?"last "+s:s;h.append(a("<div class='"+s+"' style='width:"+(Math.round(100/g)-2)+"%; float: "+b.float+";'></div>"))}for(var r=0;r<g-(b.overflow?0:1)||o&&q.children().length;){h.children().length<=r&&h.append(a("<div class='"+s+"' style='width:"+(Math.round(100/g)-2)+"%; float: "+b.float+";'></div>"));var t=h.children().eq(r);for(c(t,q,t,m),q.children().find(":first-child").hasClass("dontend")||d(t,q,t,m);f(t.children(":last").length&&t.children(":last").get(0));){var u=t.children(":last");u.remove(),q.prepend(u)}r++}if(b.overflow&&!o){var v=document.all&&-1!=navigator.appVersion.indexOf("MSIE 7.");if(v){for(var w="",x=document.createElement("DIV");0<q[0].childNodes.length;){for(var y=q[0].childNodes[0],r=0;r<y.attributes.length;r++)0==y.attributes[r].nodeName.indexOf("jQuery")&&y.removeAttribute(y.attributes[r].nodeName);x.innerHTML="",x.appendChild(q[0].childNodes[0]),w+=x.innerHTML}var z=a(b.overflow.id)[0];z.innerHTML=w}else a(b.overflow.id).empty().append(q.children().clone(!0))}else if(!o){for(t=h.children().eq(h.children().length-1);q.children().length;)t.append(q.children(":first"));var A=t.height(),B=0,C=1e7,D=0,E=!1;h.children().each(function(a){return function(b){var c=a.children().eq(b).height();E=!1,B+=c,c>D&&(D=c,E=!0),c<C&&(C=c)}}(h));var F=B/g;b.lastNeverTallest&&E?(m+=30,p==n-1&&n++):30<D-C?m=F+30:20<Math.abs(F-m)?m=F:p=n}else h.children().each(function(a){t=h.children().eq(a),t.width(b.width+"px"),0==a?t.addClass("first"):a==h.children().length-1?t.addClass("last"):(t.removeClass("first"),t.removeClass("last"))}),h.width(h.children().length*b.width+"px");h.append(a("<br style='clear:both;'>"))}h.find(".column").find(":first.removeiffirst").remove(),h.find(".column").find(":last.removeiflast").remove(),h.data("columnizing",!1),b.overflow&&b.overflow.doneFunc(),b.doneFunc()}}}var h=b.target?a(b.target):a(this),j=a(this).height(),k=a("<div></div>"),l=0;if(k.append(a(this).children().clone(!0)),!b.ignoreImageLoading&&!b.target&&!h.data("imageLoaded")&&(h.data("imageLoaded",!0),0<a(this).find("img").length)){var m=function(a,c){return function(){a.data("firstImageLoaded")||(a.data("firstImageLoaded","true"),a.empty().append(c.children().clone(!0)),a.columnize(b))}}(a(this),k);return a(this).find("img").one("load",m),void a(this).find("img").one("abort",m)}h.empty(),g(),b.buildOnce||a(window).resize(function(){!b.buildOnce&&a.browser.msie?(h.data("timeout")&&clearTimeout(h.data("timeout")),h.data("timeout",setTimeout(g,200))):!b.buildOnce&&g()})})}})(jQuery);